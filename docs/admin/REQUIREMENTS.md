# SNS管理画面要件定義書

## 📋 プロジェクト概要

**アプリケーション**: my-board-app（Next.js SNS掲示板アプリ）  
**本番環境**: https://kab137lab.com  
**目的**: セキュリティ重視の管理者機能実装

---

## 🛡️ セキュリティ要件（最重要）

### **認証・アクセス制御**

#### **管理者認証システム**
- **専用ログインページ**: 推測困難URL（/admin/[RANDOM_TOKEN]）
- **多層認証**: 
  - メールアドレス + パスワード
  - メール認証（6桁コード）
  - 2段階認証（TOTP）オプション
- **セッション管理**: 
  - 短時間タイムアウト（30分）
  - 自動ログアウト・アイドル検出
  - セキュアCookie・CSRF対策

#### **IP・アクセス制限**
- **IP ホワイトリスト**: 許可IPからのみアクセス
- **ブルートフォース対策**: 
  - レート制限（5回/分）
  - 一時ロック（15分）
  - 管理者アラート送信

#### **権限管理（3段階）**
```typescript
type AdminLevel = 'admin' | 'moderator' | 'audit';

// admin: 全機能アクセス・システム設定変更
// moderator: ユーザー・投稿管理（設定変更不可）
// audit: 読み取り専用・ログ閲覧のみ
```

---

## 👥 ユーザー管理機能

### **ユーザー一覧・検索**
- **表示項目**: ID・名前・メール・権限・登録日・最終活動
- **検索機能**: 名前・メール・ユーザー名での部分一致検索
- **フィルタリング**: 権限・状態・活動期間・地域
- **ソート**: 登録日・最終活動・投稿数・フォロワー数

### **ユーザー詳細管理**
#### **基本情報**
- **プロフィール**: 名前・メール・自己紹介・プロフィール画像
- **アカウント状態**: アクティブ・一時停止・削除済み
- **権限情報**: 現在の権限・権限変更履歴

#### **活動統計**
- **投稿活動**: 総投稿数・いいね数・コメント数
- **ソーシャル**: フォロワー数・フォロー数・エンゲージメント率
- **ログイン**: 最終ログイン・ログイン頻度・デバイス情報

#### **操作・アクション**
- **アカウント操作**: 
  - 一時停止・復活・削除・権限変更
  - パスワードリセット・メール認証再送信
- **通信管理**: 
  - ダイレクトメッセージ送信・警告通知
  - システムアナウンス配信

### **一括操作**
- **条件指定**: 複数条件でのユーザー抽出
- **一括処理**: 権限変更・メール送信・一時停止
- **エクスポート**: CSV・Excel形式でのユーザーデータ出力

---

## 📝 投稿・コンテンツ管理

### **投稿一覧・管理**
#### **表示・検索**
- **投稿一覧**: 全投稿表示・ページング・ソート
- **検索機能**: タイトル・内容・ハッシュタグでの検索
- **フィルタ**: 
  - 状態（公開・非表示・削除・報告済み）
  - 投稿タイプ（テキスト・画像・動画）
  - 期間・投稿者・エンゲージメント

#### **投稿詳細**
- **基本情報**: タイトル・内容・作成者・作成日時
- **エンゲージメント**: いいね数・コメント数・シェア数
- **メディア**: 画像・動画・ファイルの表示・ダウンロード
- **技術情報**: IP・デバイス・リファラー

### **モデレーション機能**
#### **投稿操作**
- **表示制御**: 非表示・復活・削除・編集
- **カテゴリ**: 不適切・スパム・著作権・その他
- **理由記録**: 操作理由・管理者コメント

#### **自動化機能**
- **スパム検知**: 
  - キーワードフィルタ・URLブラックリスト
  - 投稿頻度・パターン分析
  - AI判定（将来拡張）
- **報告システム**: 
  - ユーザー報告の自動分類
  - 優先順位付け・担当者割り当て

### **一括モデレーション**
- **条件指定**: 複数条件での投稿抽出
- **一括操作**: 非表示・削除・カテゴリ変更
- **通知**: 投稿者への自動通知・理由説明

---

## 📊 分析・レポート機能

### **ダッシュボード統計**
#### **リアルタイム指標**
- **ユーザー**: 総数・アクティブ・新規登録・オンライン数
- **投稿**: 総数・今日の投稿・エンゲージメント・削除済み
- **モデレーション**: 未処理報告・処理済み・自動対応

#### **トレンド分析**
- **成長指標**: ユーザー増加率・投稿増加率・エンゲージメント率
- **人気コンテンツ**: トレンドハッシュタグ・人気投稿・アクティブユーザー
- **問題指標**: 報告数・削除数・スパム検知数

### **詳細レポート**
#### **ユーザー分析**
- **デモグラフィック**: 地域・年代・登録経路
- **行動パターン**: アクティブ時間・利用頻度・機能利用率
- **離脱分析**: 退会理由・離脱タイミング

#### **コンテンツ分析**
- **投稿品質**: 文字数・メディア使用率・リアクション率
- **ハッシュタグ**: 使用頻度・トレンド・カテゴリ分析
- **エンゲージメント**: いいね・コメント・シェア分析

### **レポートエクスポート**
- **形式**: CSV・Excel・JSON・PDF
- **スケジュール**: 日次・週次・月次自動生成
- **カスタム**: 期間・指標指定での個別レポート

---

## 🔍 監査・ログ管理

### **操作ログ記録**
#### **記録対象**
- **管理者操作**: 全ての管理者・モデレーター操作
- **重要ユーザー操作**: アカウント作成・削除・権限変更
- **システム操作**: ログイン・ログアウト・設定変更

#### **記録項目**
```typescript
interface AuditLog {
  adminUserId: string;        // 実行者
  action: AdminAction;        // 操作内容
  targetType: TargetType;     // 対象タイプ
  targetId?: string;          // 対象ID
  timestamp: Date;            // 実行時刻
  ipAddress: string;          // IPアドレス
  userAgent: string;          // ブラウザ情報
  result: 'success' | 'failure'; // 結果
  changes?: object;           // 変更内容
  reason?: string;            // 操作理由
}
```

### **ログ分析・検索**
- **高度検索**: 
  - 実行者・期間・操作タイプ・対象での検索
  - 結果フィルタ・IP範囲指定
- **統計表示**: 
  - 操作頻度・実行者別・操作タイプ別集計
  - 異常パターン・セキュリティアラート

### **エクスポート・アーカイブ**
- **データエクスポート**: CSV・JSON形式・期間指定
- **長期保存**: 1年間保存・自動アーカイブ
- **コンプライアンス**: 監査要求への対応・透明性確保

---

## ⚙️ システム設定・運用

### **システム設定（管理者専用）**
#### **セキュリティ設定**
- **認証設定**: セッションタイムアウト・2FA必須・IP制限
- **アクセス制御**: 権限レベル・機能制限・緊急アクセス
- **監査設定**: ログ保存期間・自動アラート・レポート頻度

#### **モデレーション設定**
- **自動化**: スパム検知レベル・自動削除閾値
- **キーワードフィルタ**: NGワード・URL制限・自動隠蔽
- **報告処理**: 自動分類・優先度・担当者割当

### **システム監視**
#### **ヘルスチェック**
- **サーバー状態**: CPU・メモリ・ディスク使用率
- **データベース**: 接続状態・レスポンス時間・容量
- **外部サービス**: Cloudinary・メール・認証サービス

#### **パフォーマンス監視**
- **レスポンス時間**: API・ページ読み込み・データベースクエリ
- **エラー率**: 4xx・5xxエラー・例外発生
- **リソース使用**: 帯域・ストレージ・CDN使用量

### **バックアップ・保守**
- **データバックアップ**: 
  - 日次自動バックアップ・世代管理
  - 重要データの即座バックアップ
- **システム保守**: 
  - 定期メンテナンス・アップデート
  - セキュリティパッチ・脆弱性対応

---

## 🎯 実装優先度・MVP定義

### **MVP（最小実行可能製品）- Phase 1**
#### **必須機能**
1. **基本認証**: 管理者ログイン・権限チェック・セキュリティ
2. **ユーザー一覧**: 基本情報表示・簡易検索・権限確認
3. **投稿一覧**: 基本情報表示・簡易削除・非表示機能
4. **基本統計**: アクティブユーザー・投稿数・基本指標

#### **成功基準**
- 管理者が安全にログイン・基本操作可能
- ユーザー・投稿の一覧確認・基本管理実行可能
- セキュリティ要件（権限・アクセス制御）完全達成

### **機能拡張 - Phase 2-3**
#### **Phase 2: 高度管理機能**
1. **詳細ユーザー管理**: 統計・履歴・一括操作
2. **高度モデレーション**: 自動検知・一括処理・報告システム
3. **検索・フィルタ**: 高度検索・複数条件・エクスポート

#### **Phase 3: 監査・運用**
1. **監査ログ**: 全操作記録・検索・エクスポート
2. **高度分析**: トレンド・レポート・予測分析
3. **システム管理**: 設定・監視・アラート・バックアップ

---

## 🔗 既存システム統合

### **技術スタック活用**
- **Next.js 15.4.5**: App Router・API Routes・サーバーサイドレンダリング
- **React 19.1.0**: 最新機能・パフォーマンス最適化
- **Material-UI 7.2.0**: 既存デザインシステム統合・一貫性確保
- **TypeScript 5**: 型安全性・開発効率・エラー防止

### **インフラ・サービス**
- **MongoDB Atlas**: 既存スキーマ拡張・パフォーマンス維持
- **NextAuth.js v4**: role-based access control拡張
- **Vercel**: 本番デプロイ・環境変数・セキュリティ
- **Cloudinary**: 画像管理・CDN・最適化

### **既存機能との統合**
- **ユーザー管理**: 既存User model拡張・権限フィールド追加
- **投稿管理**: 既存Post model活用・モデレーション情報追加
- **認証系**: NextAuth session拡張・管理者メタデータ追加

---

## 💡 ユーザビリティ要件

### **管理者体験（Admin UX）**
#### **ダッシュボード設計**
- **重要指標優先**: 一目でシステム状況把握
- **アラート表示**: 緊急対応事項・優先業務
- **クイックアクション**: 頻繁操作への即座アクセス

#### **操作効率**
- **一括操作**: 複数選択・条件指定・確認ダイアログ
- **キーボードショートカット**: 高速操作・専門ユーザー対応
- **操作履歴**: 前回操作・お気に入り・頻用機能

### **レスポンシブ対応**
- **デスクトップ**: 左サイドバー・メイン画面・詳細パネル
- **タブレット**: 折りたたみサイドバー・タッチ操作最適化
- **モバイル**: ボトムナビゲーション・簡易操作・重要機能優先

---

## 🎯 成功基準・KPI

### **セキュリティKPI**
- **不正アクセス**: ゼロ・セキュリティインシデントなし
- **権限昇格**: 防止・ログ記録・即座検出
- **データ漏洩**: 防止・暗号化・アクセス制御

### **運用効率KPI**
- **モデレーション時間**: 従来比50%短縮
- **ユーザー対応**: 問い合わせ対応時間短縮
- **管理者作業**: 日次管理業務の自動化・効率化

### **システム品質KPI**
- **パフォーマンス**: 既存機能への影響なし・レスポンス維持
- **可用性**: 99.9%アップタイム・メンテナンス最小化
- **拡張性**: 新機能追加・ユーザー増加への対応

---

## 📅 実装スケジュール

### **Week 1: MVP実装**
- **Day 1-2**: セキュア認証・基本権限制御
- **Day 3-4**: ユーザー一覧・基本管理機能
- **Day 5-7**: 投稿一覧・基本モデレーション・統合テスト

### **Week 2: 機能拡張**
- **Day 8-10**: 詳細管理・検索・フィルタ・一括操作
- **Day 11-12**: 統計・レポート・ダッシュボード
- **Day 13-14**: 自動化・アラート・最適化

### **Week 3: 完成・運用**
- **Day 15-17**: 監査ログ・エクスポート・システム設定
- **Day 18-19**: テスト・ドキュメント・セキュリティレビュー  
- **Day 20-21**: 本番デプロイ・運用開始・監視設定

---

**重要**: この要件定義は**my-board-app の既存技術スタック・インフラを最大活用**し、**企業レベルのセキュリティ**を確保した管理者機能実現を目指します。